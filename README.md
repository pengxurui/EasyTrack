![](https://github.com/pengxurui/AndroidFamily/blob/master/images/Android_Banner.png)
  
<p align='center'>
  <a>
    <img src="https://www.jitpack.io/v/pengxurui/EasyTrack.svg">
  </a>
  <a href="https://www.github.com/pengxurui" target="_blank">
    <img src="https://komarev.com/ghpvc/?username=pengxurui&style=flat&label=ğŸ‘%20Views">
  </a>
</p>


<p align='center'>
  <a href="https://www.github.com/pengxurui" target="_blank">
    <img src="https://img.shields.io/badge/ä½œè€…-@å°å½­-brightgreen.svg?style=flat&logo=GitHub">
  </a>
  <a href="https://github.com/pengxurui/Android-NoteBook/raw/master/images/æœä¸€æœå…¬ä¼—å·.png" target="_blank">
    <img src="https://img.shields.io/badge/å…¬ä¼—å·-å½­æ—­é”-brightgreen.svg?style=flat&logo=WeChat">
  </a>
  <a href="https://juejin.cn/user/1063982987230392" target="_blank">
    <img src="https://img.shields.io/badge/ğŸ”¥%20juejin-æ˜é‡‘-blue.svg?style=flat">
  </a>
  <a href="https://www.zhihu.com/people/pengxurui" target="_blank">
    <img src="https://img.shields.io/badge/zhihu-çŸ¥ä¹-informational.svg?style=flat&logo=Zhihu">
  </a>
  <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAbY-k9r66YVymjlqMaaGZJO67hCNYaNGa7PCoisQYmR4" target="_blank">
    <img src="https://img.shields.io/badge/toutiao-å¤´æ¡-red.svg?style=flat">
  </a>
  <a href="https://www.cnblogs.com/pengxurui/" target="_blank">
    <img src="https://img.shields.io/badge/cnblogs-åšå®¢å›­-green.svg?style=flat">
  </a>
  <a href="https://blog.csdn.net/pengxurui?spm=1000.2115.3001.5343" target="_blank">
    <img src="https://img.shields.io/badge/csdn-CSDN-9cf.svg?style=flat">
  </a>
  <a href="" target="_blank">
    <img src="https://img.shields.io/badge/jianshu-ç®€ä¹¦-orange.svg?style=flat">
  </a>
</p>


# å‰è¨€

- ç›®å‰ï¼Œå‡ ä¹æ¯ä¸ªå•†ç”¨åº”ç”¨éƒ½æœ‰æ•°æ®åŸ‹ç‚¹çš„éœ€æ±‚ã€‚ä½ çš„ App æ˜¯æ€ä¹ˆåšåŸ‹ç‚¹çš„å‘¢ï¼Œæœ‰é‡åˆ°è®©ä½  â€œéš¾é¡¶â€ çš„é—®é¢˜å—ï¼Ÿ
- åœ¨è¿™ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘å°†å¸¦ä½ å»ºç«‹æ•°æ®åŸ‹ç‚¹çš„åŸºæœ¬è®¤è¯†ï¼Œè¿˜ä¼šä»‹ç»è¥¿ç“œè§†é¢‘å›¢é˜Ÿçš„å‰ç«¯åŸ‹ç‚¹æ–¹æ¡ˆï¼Œæœ€åä¸ºä½ å¸¦æ¥æˆ‘çš„è½åœ°å®ç° EasyTrackã€‚

---
# ç›®å½•

![](https://github.com/pengxurui/EasyTrack/blob/master/images/EasyTrack%20-%20%E7%9B%AE%E5%BD%95.png)

---
# 1. æ•°æ®åŸ‹ç‚¹æ¦‚è¿°

#### 1.1 ä¸ºä»€ä¹ˆè¦åŸ‹ç‚¹ï¼Ÿ

â€œé™¤äº†ä¸Šå¸ï¼Œä»»ä½•äººéƒ½å¿…é¡»ç”¨æ•°æ®è¯´è¯â€ï¼Œåœ¨æ•°æ®æ—¶ä»£ï¼Œä½¿ç”¨æ•°æ®é©±åŠ¨äº§å“è¿­ä»£å·²ç»ç§°ä¸ºè¡Œä¸šå…±è¯†ã€‚åœ¨åˆ†æåº”ç”¨æ•°æ®ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦è·å¾—æ•°æ®ï¼Œè¿™å°±éœ€è¦å‰ç«¯æˆ–æœåŠ¡ç«¯è¿›è¡Œæ•°æ®åŸ‹ç‚¹ã€‚

#### 1.2 æ•°æ®éœ€æ±‚çš„å·¥ä½œæµç¨‹

é¦–å…ˆï¼Œä½ éœ€è¦äº†è§£æ•°æ®éœ€æ±‚çš„å·¥ä½œæµç¨‹ï¼Œéœ€æ±‚æ˜¯å¦‚ä½•äº§ç”Ÿï¼Œåˆæ˜¯å¦‚ä½•æµè½¬çš„ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªç¯èŠ‚ï¼š

- **1ã€éœ€æ±‚äº§ç”Ÿï¼š** äº§å“éœ€æ±‚å¼•èµ·äº§å“å½¢æ€å˜åŒ–ï¼Œäº§ç”Ÿæ–°çš„æ•°æ®éœ€æ±‚ï¼›
- **2ã€äº‹ä»¶è®¾è®¡ï¼š** æ•°æ®äº§å“è®¾è®¡åŸ‹ç‚¹äº‹ä»¶å¹¶æ›´æ–°æ•°æ®å­—å…¸æ–‡æ¡£ï¼Œæå‡ºåŸ‹ç‚¹è¯„å®¡ï¼›
- **3ã€åŸ‹ç‚¹å¼€å‘ï¼š** å¼€å‘è¿›è¡Œæ•°æ®åŸ‹ç‚¹å¼€å‘ï¼›
- **4ã€åŸ‹ç‚¹æµ‹è¯•ï¼š** æµ‹è¯•è¿›è¡Œæ•°æ®åŸ‹ç‚¹æµ‹è¯•ï¼Œç¡®ä¿æ•°æ®è´¨é‡ï¼›
- **5ã€æ•°æ®æ¶ˆè´¹ï¼š** æ•°æ®åˆ†æå¸ˆè¿›è¡Œæ•°æ®åˆ†æï¼Œæ¨èç³»ç»Ÿå·¥ç¨‹å¸ˆè¿›è¡Œæ¨¡å‹è®­ç»ƒï¼Œèµ‹èƒ½äº§å“è¿è¥å†³ç­–ã€‚

![](https://github.com/pengxurui/EasyTrack/blob/master/images/EasyTrack%20-%20%E6%B5%81%E7%A8%8B.png)

#### 1.3 æ•°æ®æ¶ˆè´¹çš„ç»å…¸åœºæ™¯

|æ¶ˆè´¹åœºæ™¯|éœ€æ±‚æè¿°|æŠ€æœ¯éœ€æ±‚|
|:---|:---|:---|
|**æ¸—é€ç‡åˆ†æ**|ç»Ÿè®¡ DAU/PV/UV/VV ç­‰|å‡†ç¡®çš„ä¸ŠæŠ¥æ—¶æœº|
|**å½’å› åˆ†æ**|åˆ†æå‰å› åæœ|å‡†ç¡®ä¸ŠæŠ¥ä¸Šä¸‹æ–‡ (å¦‚åœºæ™¯ã€ä¼šè¯ã€æ¥æºé¡µé¢)|
|**1. A / B æµ‹è¯•<br>2. ä¸ªæ€§åŒ–æ¨è**|åˆ†æç”¨æˆ·ç‰¹å¾ã€äº§å“ç‰¹å¾ç­‰|å‡†ç¡®ä¸ŠæŠ¥äº‹ä»¶å±æ€§| 

å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å½’å› åˆ†æä¸­ï¼Œé™¤äº†éœ€è¦ä¸ŠæŠ¥äº‹ä»¶æœ¬èº«çš„å±æ€§ä¹‹å¤–ï¼Œè¿˜éœ€è¦ä¸ŠæŠ¥äº‹ä»¶äº§ç”Ÿæ—¶çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¾‹å¦‚å½“å‰é¡µé¢ã€æ¥æºé¡µé¢ã€ä¼šè¯ç­‰ã€‚

#### 1.4 åŸ‹ç‚¹æ•°æ®é‡‡é›†çš„åŸºæœ¬æ¨¡å‹

æ•°æ®é‡‡é›†æ˜¯æŒ‡åœ¨å‰ç«¯æˆ–æœåŠ¡ç«¯æ”¶é›†éœ€è¦ä¸ŠæŠ¥çš„äº‹ä»¶å±æ€§çš„è¿‡ç¨‹ã€‚ä¸ºäº†æ»¡è¶³å¤æ‚ã€é«˜æ•ˆçš„æ•°æ®æ¶ˆè´¹éœ€æ±‚ï¼Œéœ€è¦ç§‘å­¦åˆç†åœ°è®¾è®¡ç«¯ä¾§çš„æ•°æ®é‡‡é›†é€»è¾‘ï¼ŒåŸºæœ¬å¯ä»¥æ€»ç»“ä¸º â€œ4W + 1Hâ€ æ¨¡å‹ï¼š

|æ¨¡å‹|æè¿°|ä¸¾ä¾‹|
|:---|:---|:---|
|**1ã€WHAT**|ä»€ä¹ˆè¡Œä¸º|äº‹ä»¶å|
|**2ã€WHEN**|è¡Œä¸ºäº§ç”Ÿçš„æ—¶é—´|æ—¶é—´æˆ³|
|**3ã€WHO** |è¡Œä¸ºäº§ç”Ÿçš„å¯¹è±¡|å¯¹è±¡å”¯ä¸€æ ‡è¯† (ä¾‹å¦‚ç”¨æˆ· IDã€è®¾å¤‡ ID)|
|**4ã€WHERE**|è¡Œä¸ºäº§ç”Ÿçš„ç¯å¢ƒ|è®¾å¤‡æ‰€å¤„çš„ç¯å¢ƒ (ä¾‹å¦‚ IPã€æ“ä½œç³»ç»Ÿã€ç½‘ç»œ)|
|**5ã€HOW**|è¡Œä¸ºçš„ç‰¹å¾|ä¸Šä¸‹æ–‡ä¿¡æ¯ (ä¾‹å¦‚å½“å‰é¡µé¢ã€æ¥æºé¡µé¢ã€ä¼šè¯)|

---
# 2. å¦‚ä½•å®ç°æ•°æ®åŸ‹ç‚¹ï¼Ÿ

#### 2.1 åŸ‹ç‚¹æ–¹æ¡ˆæ€»ç»“

ç›®å‰ï¼Œä¸šç•Œå·²ç»å­˜åœ¨å¤šç§åŸ‹ç‚¹æ–¹æ¡ˆï¼Œä¸»è¦åˆ†ä¸ºå…¨åŸ‹ç‚¹ã€å‰ç«¯ä»£ç åŸ‹ç‚¹å’ŒæœåŠ¡ç«¯ä»£ç åŸ‹ç‚¹ä¸‰ç§ï¼Œä¼˜ç¼ºç‚¹å’Œé€‚ç”¨åœºæ™¯æ€»ç»“å¦‚ä¸‹ï¼š

||å…¨åŸ‹ç‚¹|å‰ç«¯åŸ‹ç‚¹|æœåŠ¡ç«¯åŸ‹ç‚¹|
|:---|:---|:---|:---|
|ä¼˜åŠ¿|å¼€å‘æˆæœ¬ä½|å®Œæ•´é‡‡é›†ä¸Šä¸‹æ–‡ä¿¡æ¯|ä¸ä¾èµ–äºå‰ç«¯ç‰ˆæœ¬|
|åŠ£åŠ¿|æ•°æ®é‡å¤§ï¼Œæ— æ³•è·å–ä¸Šä¸‹æ–‡æ•°æ®ï¼Œæ•°æ®è´¨é‡ä½|å‰ç«¯å¼€å‘æˆæœ¬è¾ƒé«˜|æœåŠ¡ç«¯å¼€å‘æˆæœ¬è¾ƒé«˜ã€è·å–ä¸Šä¸‹æ–‡ä¿¡æ¯ä¾èµ–äºæ¥å£ä¼ å€¼|
|é€‚ç”¨åœºæ™¯|é€šç”¨åŸºç¡€äº‹ä»¶ï¼ˆå¦‚å¯åŠ¨/é€€å‡ºã€æµè§ˆã€ç‚¹å‡»ï¼‰|æ ¸å¿ƒä¸šåŠ¡æµç¨‹ï¼ˆå¦‚ç™»å½•ã€æ³¨å†Œã€æ”¶è—ã€è´­ä¹°ï¼‰|æ ¸å¿ƒä¸šåŠ¡ç»“æœäº‹ä»¶ï¼ˆå¦‚æ”¯ä»˜æˆåŠŸï¼‰|

- **1ã€å…¨åŸ‹ç‚¹ï¼š** æŒ‡é€šè¿‡ç¼–è¯‘æ—¶æ’æ¡©ã€è¿è¡Œæ—¶åŠ¨æ€ä»£ç†ç­‰ AOP æ‰‹æ®µå®ç°è‡ªåŠ¨åŸ‹ç‚¹å’Œä¸ŠæŠ¥ï¼Œæ— é¡»å¼€å‘è€…æ‰‹åŠ¨è¿›è¡ŒåŸ‹ç‚¹ï¼Œå› æ­¤ä¹Ÿç§°ä¸º â€œæ— åŸ‹ç‚¹â€ï¼›

- **2ã€å‰ç«¯åŸ‹ç‚¹ï¼š** æŒ‡å‰ç«¯ (åŒ…æ‹¬å®¢æˆ·ç«¯) å¼€å‘è€…æ‰‹åŠ¨ç¼–ç å®ç°åŸ‹ç‚¹ï¼Œè™½ç„¶å¯ä»¥é€šè¿‡åŸ‹ç‚¹å·¥å…·æˆ–è€…è„šæœ¬ç®€åŒ–åŸ‹ç‚¹å¼€å‘å·¥ä½œï¼Œä½†æ€»ä½“ä¸Šè¿˜æ˜¯éœ€è¦æ‰‹åŠ¨æ“ä½œï¼›

- **3ã€æœåŠ¡ç«¯åŸ‹ç‚¹ï¼š** æŒ‡æœåŠ¡ç«¯æ‰‹åŠ¨ç¼–ç å®ç°åŸ‹ç‚¹ï¼Œç¼ºç‚¹æ˜¯éœ€è¦å®¢æˆ·ç«¯éœ€è¦ä¾µå…¥æ¥å£æ¥ä¿ç•™ä¸Šä¸‹æ–‡å‚æ•°ã€‚

#### 2.2 å…¨åŸ‹ç‚¹æ–¹æ¡ˆçš„å±€é™æ€§

è¡¨é¢ä¸Šçœ‹ï¼Œå…¨åŸ‹ç‚¹æ–¹æ¡ˆçš„ä¼˜åŠ¿å¾ˆæ˜æ˜¾ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åªéœ€è¦ä¸€æ¬¡å¼€å‘ï¼Œå°±èƒ½å®ç°æ‰€æœ‰é¡µé¢ã€æ‰€æœ‰è·¯å¾„çš„æ›å…‰å’Œç‚¹å‡»äº‹ä»¶åŸ‹ç‚¹ï¼ŒèŠ‚çœäº†ç ”å‘äººåŠ›ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒåŸ‹ç‚¹é€»è¾‘ä¼šä¾µå…¥æ­£å¸¸ä¸šåŠ¡é€»è¾‘ã€‚ç„¶è€Œï¼Œä¸å¯èƒ½å­˜åœ¨å®Œç¾çš„è§£å†³æ–¹æ¡ˆï¼Œå…¨åŸ‹ç‚¹æ–¹æ¡ˆè¿˜æ˜¯å­˜åœ¨ä¸€äº›å±€é™æ€§ï¼š

- **1ã€èµ„æºæ¶ˆè€—è¾ƒå¤§ï¼š** å…¨åœºæ™¯ä¸ŠæŠ¥ä¼šäº§ç”Ÿå¤§é‡æ— ç”¨æ•°æ®ï¼Œç½‘ç»œä¼ è¾“ã€æ•°æ®å­˜å‚¨å’Œæ•°æ®è®¡ç®—éœ€è¦æ¶ˆè€—å¤§é‡èµ„æºï¼›

- **2ã€é¡µé¢ç¨³å®šæ€§è¦æ±‚è¾ƒé«˜ï¼š** éœ€è¦ä¿æŒé¡µé¢è§†å›¾ç»“æ„ç›¸å¯¹ç¨³å®šï¼Œä¸€æ—¦é¡µé¢è§†å›¾ç»“æœå˜åŒ–ï¼Œå†å²å½•å…¥çš„åŸ‹ç‚¹æ•°æ®å°±ä¼šå¤±æ•ˆï¼›

- **3ã€æ— æ³•é‡‡é›†ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š** æ— æ³•é‡‡é›†äº‹ä»¶äº§ç”Ÿæ—¶çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¹Ÿå°±æ— æ³•æ»¡è¶³å¤æ‚çš„æ•°æ®æ¶ˆè´¹éœ€æ±‚ã€‚

#### 2.3 åŸ‹ç‚¹è®¾è®¡çš„æ•´ä½“æ–¹æ¡ˆ

è€ƒè™‘çš„ä¸åŒæ–¹æ¡ˆéƒ½å­˜åœ¨ä¼˜ç¼ºç‚¹ï¼Œå•çº¯é‡‡ç”¨ä¸€ç§åŸ‹ç‚¹æ–¹æ¡ˆæ˜¯ä¸åˆ‡å®é™…çš„ï¼Œéœ€è¦æ ¹æ®ä¸åŒä¸šåŠ¡åœºæ™¯å’Œä¸åŒæ•°æ®æ¶ˆè´¹éœ€è¦è€Œé‡‡ç”¨ä¸åŒçš„åŸ‹ç‚¹æ–¹æ¡ˆï¼š

- **1ã€å…¨åŸ‹ç‚¹ï¼š** ä½œä¸ºå…¨å±€å…œåº•æ–¹æ¡ˆï¼Œå¯ä»¥æ»¡è¶³ç²—ç²’åº¦çš„ç»Ÿè®¡éœ€æ±‚ï¼›

- **2ã€å‰ç«¯åŸ‹ç‚¹ï¼š** ä½œä¸ºå…¨åŸ‹ç‚¹çš„è¡¥å……æ–¹æ¡ˆï¼Œå¯ä»¥è‡ªå®šä¹‰åŸ‹ç‚¹å‚æ•°ï¼Œä¸»è¦å¤„ç†æ ¸å¿ƒä¸šåŠ¡æµç¨‹äº‹ä»¶ï¼Œä¾‹å¦‚ï¼ˆå¦‚ç™»å½•ã€æ³¨å†Œã€æ”¶è—ã€è´­ä¹°ï¼‰ï¼›

- **3ã€æœåŠ¡ç«¯åŸ‹ç‚¹ï¼š** æ ¸å¿ƒä¸šåŠ¡ç»“æœäº‹ä»¶ï¼Œä¾‹å¦‚è®¢å•æ”¯ä»˜æˆåŠŸã€‚

---
# 3. å‰ç«¯åŸ‹ç‚¹ä¸­çš„å›°éš¾

#### 3.1 ä¸€ä¸ªç®€å•çš„åŸ‹ç‚¹åœºæ™¯

ç°åœ¨ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…·ä½“çš„åŸ‹ç‚¹åœºæ™¯ï¼Œè¯•ç€å‘ç°åœ¨åšåŸ‹ç‚¹éœ€æ±‚æ—¶ä¼šé‡åˆ°çš„å›°éš¾æˆ–ç—›ç‚¹ã€‚æˆ‘ç›´æ¥ä½¿ç”¨è¥¿ç“œè§†é¢‘ä¸­çš„ä¸€ä¸ªåŸ‹ç‚¹åœºæ™¯ï¼š

![](https://github.com/pengxurui/EasyTrack/blob/master/images/EasyTrack%20-%20%E5%9B%B0%E9%9A%BE.png)

â€”â€” å›¾ç‰‡å¼•ç”¨è‡ªè¥¿ç“œè§†é¢‘æŠ€æœ¯åšå®¢

è¿™ä¸ªäº§å“åœºæ™¯å¾ˆç®€å•ï¼Œå·¦è¾¹æ˜¯è¥¿ç“œè§†é¢‘çš„æ¨èæµåˆ—è¡¨ï¼Œç‚¹å‡» â€œç”µå½±å¡ç‰‡â€ ä¼šè¿›å…¥å³è¾¹çš„ â€œç”µå½±è¯¦æƒ…é¡µâ€ ã€‚**ä¸¤ä¸ªé¡µé¢ä¸­éƒ½æœ‰ â€œæ”¶è—æŒ‰é’®â€ï¼Œç°åœ¨çš„æ•°æ®éœ€æ±‚æ˜¯é‡‡é›†ä¸åŒé¡µé¢ä¸­ â€œæ”¶è—æŒ‰é’®â€ çš„ç‚¹å‡»äº‹ä»¶ï¼Œä»¥ä¾¿åˆ†æç”¨æˆ·æ”¶è—å½±ç‰‡çš„è¡Œä¸ºï¼Œä¼˜åŒ–å½±ç‰‡çš„æ¨èæ¨¡å‹ã€‚**

- **1ã€åœ¨æ¨èåˆ—è¡¨é¡µä¸­ä¸ŠæŠ¥ç‚¹å‡»äº‹ä»¶ï¼š**
```
â€œevent_name" : "click_favorite", // äº‹ä»¶å
"cur_page" : "feed",             // å½“å‰é¡µé¢
"video_id" : "123",              // å½±ç‰‡ ID
"video_name" : "å½±ç‰‡å",          // å½±ç‰‡å
"video_type" : "1",              // å½±ç‰‡ç±»å‹
"$user_id" : "10000",            // ç”¨æˆ· ID
"$device_id" : "abc"             // è®¾å¤‡ ID
...                              // å…¶ä»–é¢„ç½®å±æ€§
```

- **2ã€åœ¨ç”µå½±è¯¦æƒ…é¡µä¸­ä¸ŠæŠ¥ç‚¹å‡»äº‹ä»¶ï¼š**
```
â€œevent_name" : "click_favorite", // äº‹ä»¶å
"from_page" : "feed"
"cur_page" : "video_detail",     // å½“å‰é¡µé¢
"video_id" : "123",              // å½±ç‰‡ ID
"video_name" : "å½±ç‰‡å",          // å½±ç‰‡å
"video_type" : "1",              // å½±ç‰‡ç±»å‹
"$user_id" : "10000",            // ç”¨æˆ· ID
"$device_id" : "abc"             // è®¾å¤‡ ID
...                              // å…¶ä»–é¢„ç½®å±æ€§
```

#### 3.2 ç°çŠ¶åˆ†æ

ç†è§£äº†è¿™ä¸ªåŸ‹ç‚¹åœºæ™¯ä¹‹åï¼Œæˆ‘ä»¬å…ˆæ¢³ç†å‡ºç›®å‰é‡åˆ°çš„å›°éš¾ï¼š

- **1ã€åŸ‹ç‚¹å‚æ•°åˆ†æ•£ï¼š** éœ€è¦ä¸ŠæŠ¥çš„åŸ‹ç‚¹å‚æ•°ä½äºä¸åŒ UI å®¹å™¨æˆ–ä¸åŒä¸šåŠ¡æ¨¡å—ï¼Œä»£ç è·¨åº¦å¾ˆå¤§ï¼ˆä¾‹å¦‚ï¼šActivityã€Fragmentã€ViewHolderã€è‡ªå®šä¹‰ Viewï¼‰ï¼›

- **2ã€ç»„ä»¶å¤ç”¨ï¼š** ç»„ä»¶æŠ½è±¡å¤ç”¨ååœ¨å¤šä¸ªé¡µé¢ä½¿ç”¨ï¼ˆä¾‹å¦‚é€šç”¨çš„ ViewHolder æˆ–è‡ªå®šä¹‰ View)ï¼›

- **3ã€æ•°æ®æ¨¡å‹ä¸ä¸€è‡´ï¼š** ä¸åŒåœºæ™¯ / é¡µé¢ä¸‹æè¿°çŠ¶æ€çš„æ•°æ®æ¨¡å‹ä¸ä¸€è‡´ï¼Œéœ€è¦é¢å¤–çš„è½¬æ¢é€‚é…è¿‡ç¨‹ï¼ˆä¾‹å¦‚æœ‰çš„æ¨¡å‹ç”¨ video_type è¡¨ç¤ºå½±ç‰‡ç±»å‹ï¼Œå¦ä¸€äº›æ¨¡å‹ç”¨ videoType è¡¨ç¤ºå½±ç‰‡ç±»å‹ï¼‰ã€‚

#### 3.3 è¯„ä¼°æ ‡å‡†

ç†è§£äº†é—®é¢˜å’Œç°çŠ¶ï¼Œç°åœ¨æˆ‘ä»¬å¼€å§‹å°è¯•æ‰¾åˆ°è§£å†³æ–¹æ¡ˆã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦æƒ³æ¸…æ¥šç†æƒ³ä¸­çš„è§£å†³æ–¹æ¡ˆï¼Œåº”è¯¥æ»¡è¶³ä»€ä¹ˆæ ‡å‡†ï¼š

- **1ã€å‡†ç¡®æ€§ï¼š** è¿™æ˜¯æ ¸å¿ƒç›®æ ‡ï¼Œèƒ½å¤Ÿåœ¨ä¿è¯ä¸åŒåœºæ™¯ / é¡µé¢ä¸‹å‡†ç¡®æ”¶é›†åŸ‹ç‚¹æ•°æ®ï¼›
- **2ã€ç®€æ´æ€§ï¼š** ä½¿ç”¨æ–¹æ³•å°½å¯èƒ½ç®€å•ï¼Œæ”¶æ•›æ¨¡æ¿ä»£ç ï¼›
- **3ã€å¯ç”¨æ€§ï¼š** å°½å¯èƒ½é«˜æ•ˆç¨³å®šï¼Œä¸å®¹æ˜“å‡ºé”™ï¼Œæ€§èƒ½å¼€é”€å°ã€‚

#### 3.4 å¸¸è§„è§£å†³æ–¹æ¡ˆ

**1ã€é€çº§ä¼ é€’ â€”â€” é€šè¿‡é¢å‘å¯¹è±¡çš„å…³ç³»é€çº§ä¼ é€’åŸ‹ç‚¹å‚æ•°ï¼š**

é€šè¿‡ Android æ¡†æ¶æ”¯æŒçš„ Activity / Fragment å‚æ•°ä¼ é€’æ–¹å¼å’Œé¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ï¼Œé€çº§å°†åŸ‹ç‚¹å‚æ•°ä¼ é€’åˆ°æœ€æ·±å±‚çš„æ”¶è—æŒ‰é’®ã€‚ä¾‹å¦‚ï¼š

- **åˆ—è¡¨é¡µï¼š** Activity -> ViewModel -> FeedFragment (æ¨è) -> Adapter -> ViewHolder (ç”µå½±å¡ç‰‡) -> CollectButton (æ”¶è—æŒ‰é’®)

- **è¯¦æƒ…é¡µï¼š** Activity -> ViewModel -> DetailBottomFragmentï¼ˆåº•éƒ¨åŠŸèƒ½åŒºï¼‰ -> CollectButton (æ”¶è—æŒ‰é’®)

ç¼ºç‚¹ (å‚æ•°ä¼ é€’å›°éš¾) ï¼šä¼ é€’æ•°æ®éœ€è¦ç¼–å†™å¤§é‡é‡å¤æ¨¡æ¿ä»£ç ï¼Œå·¥ç¨‹ä»£ç è†¨èƒ€ï¼Œå¢å¤§ç»´æŠ¤éš¾åº¦ã€‚å†å åŠ ä¸Šç»„ä»¶å¤ç”¨çš„æƒ…å†µï¼Œé€çº§ä¼ é€’ä¼šè®©ä»£ç å¤æ‚åº¦éå¸¸é«˜ï¼Œå¾ˆæ˜æ˜¾ä¸æ˜¯ä¸€ä¸ªåˆç†çš„è§£å†³æ–¹æ¡ˆã€‚

**2ã€Bean ä¼ é€’ â€”â€” åœ¨ Java Bean ä¸­å¢åŠ å­—æ®µæ¥æ”¶é›†åŸ‹ç‚¹å‚æ•°ï¼š**

ç¼ºç‚¹ (è¿èƒŒå•ä¸€èŒè´£åŸåˆ™)ï¼šJava Bean ä¸­ä¾µå…¥äº†ä¸ä¸šåŠ¡æ— å…³çš„åŸ‹ç‚¹å‚æ•°ï¼ŒåŒæ—¶ä¼šé€ æˆ Java Bean æ•°æ®å†—ä½™ï¼Œå¢å¤§ç»´æŠ¤éš¾åº¦ã€‚

**3ã€å…¨å±€å•ä¾‹ â€”â€” é€šè¿‡å…¨å±€å•ä¾‹å¯¹è±¡æ¥æ”¶é›†åŸ‹ç‚¹å‚æ•°ï¼š**

è¿™ä¸ªæ–¹æ¡ˆä¸ â€œBean ä¼ é€’ â€ ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºåŸ‹ç‚¹å‚æ•°ä» Java Bean ä¸­ç§»åŠ¨åˆ°å…¨å±€å•ä¾‹ä¸­ï¼Œä½†ç¼ºç‚¹è¿˜æ˜¯å¾ˆæ˜æ˜¾ï¼š

ç¼ºç‚¹ (å†™å…¥å’Œæ¸…ç†æ—¶æœº)ï¼šå•ä¾‹ä¼šè¢«å¤šä¸ªä½ç½®å†™å…¥ï¼Œä¸€æ—¦è¢«è¦†ç›–å°±æ— æ³•è¢«æ¢å¤ï¼Œå®¹æ˜“å¯¼è‡´ä¸ŠæŠ¥é”™è¯¯ï¼›å¦å¤–æ¸…ç†çš„æ—¶æœºä¹Ÿéš¾ä»¥æŠŠæ¡ï¼Œæ¸…ç†è¿‡æ—©ä¼šå¯¼è‡´åŸ‹ç‚¹å‚æ•°ä¸¢å¤±ï¼Œæ¸…ç†è¿‡æ™šä¼šæ±¡æŸ“åé¢çš„åŸ‹ç‚¹äº‹ä»¶ã€‚

---
# 4. è¥¿ç“œè§†é¢‘æ–¹æ¡ˆ

ç†è§£äº†æ•°æ®åŸ‹ç‚¹å¼€å‘ä¸­çš„å›°éš¾ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ¡ˆå¯ä»¥ç®€åŒ–åŸ‹ç‚¹è¿‡ç¨‹ä¸­çš„å¤æ‚åº¦å‘¢ï¼Ÿæˆ‘ä»¬æ¥è®¨è®ºä¸‹è¥¿ç“œè§†é¢‘å›¢é˜Ÿåˆ†äº«çš„ä¸€ä¸ªæ€è·¯ï¼š**åŸºäºè§†å›¾æ ‘æ”¶é›†åŸ‹ç‚¹å‚æ•°ã€‚**

![](https://github.com/pengxurui/EasyTrack/blob/master/images/EasyTrack%20-%20%E8%A5%BF%E7%93%9C1.png)

![](https://github.com/pengxurui/EasyTrack/blob/master/images/EasyTrack%20-%20%E8%A5%BF%E7%93%9C2.png)

â€”â€” å›¾ç‰‡å¼•ç”¨è‡ªè¥¿ç“œè§†é¢‘æŠ€æœ¯åšå®¢

é€šè¿‡åˆ†ææ•°æ®ä¸è§†å›¾èŠ‚ç‚¹çš„å…³ç³»å¯ä»¥å‘ç°ï¼Œäº‹ä»¶çš„åŸ‹ç‚¹æ•°æ®æ­£å¥½åˆ†å¸ƒåœ¨è§†å›¾æ ‘çš„ä¸åŒèŠ‚ç‚¹ä¸­ã€‚å½“ â€œæ”¶è—æŒ‰é’®â€ è§¦å‘äº‹ä»¶æ—¶ï¼Œåªéœ€è¦æ²¿ç€è§†å›¾æ ‘é€çº§å‘ä¸ŠæŸ¥æ‰¾ (é€šè¿‡ View#getParent()) å°±å¯ä»¥æ”¶é›†åˆ°æ‰€æœ‰æ•°æ®ã€‚

å¹¶ä¸”ï¼Œæ ‘çš„åˆ†æ”¯å¤©ç„¶åœ°æ”¯æŒä¸ºå‚æ•°è®¾ç½®ä¸åŒçš„å€¼ã€‚ä¾‹å¦‚ â€œæ¨è Fragmentâ€ éœ€è¦ä¸ŠæŠ¥ â€œchannel : recommentâ€ï¼Œè€Œ â€œç”µå½± Fragmentâ€ éœ€è¦ä¸ŠæŠ¥ â€œchannel : filmâ€ã€‚å› ä¸º Fragment çš„æ ¹å¸ƒå±€å¯¹åº”æœ‰è§†å›¾æ ‘ä¸­çš„ä¸åŒèŠ‚ç‚¹ï¼Œæ‰€ä»¥åœ¨ä¸åŒ Fragment ä¸­è§¦å‘çš„äº‹ä»¶æœ€ç»ˆæ”¶é›†åˆ°çš„ â€œchannelâ€ å‚æ•°å€¼ä¹Ÿå°±ä¸åŒäº†ã€‚Nice~

---
# 5. EasyTrack åŸ‹ç‚¹æ¡†æ¶

æ€è·¯ Get åˆ°äº†ï¼Œç°åœ¨æˆ‘ä»¬æ¥è®¨è®ºå¦‚ä½•åº”ç”¨è¿™ä¸ªæ€è·¯æ¥è§£å†³é—®é¢˜ã€‚è´´å¿ƒçš„æˆ‘å·²ç»å¸®ä½ å®ç°ä¸ºä¸€ä¸ªæ¡†æ¶ EasyTrackã€‚æºç åœ°å€ï¼šhttps://github.com/pengxurui/EasyTrack

#### 5.1 æ·»åŠ ä¾èµ–

- **1ã€ä¾èµ– JitPack ä»“åº“**

åœ¨é¡¹ç›®çº§ build.gradle å£°æ˜è¿œç¨‹ä»“åº“ï¼š
```
allprojects {
    repositories {
        google()
        mavenCentral()
        // JitPack ä»“åº“
        maven { url "https://jitpack.io" }
    }
}
```
- **2ã€ä¾èµ– EasyTrack æ¡†æ¶**

åœ¨æ¨¡å—çº§ build.gradle ä¸­ä¾èµ–ç±»åº“ï¼š
```
dependencies {
    ...
    // ä¾èµ– EasyTrack æ¡†æ¶
    implementation 'com.github.pengxurui:EasyTrack:v1.0.1'
    // ä¾èµ– Kotlin å·¥å…·ï¼ˆéå¿…é¡»ï¼‰
    implementation 'com.github.pengxurui:KotlinUtil:1.0.1'
}
```

#### 5.2 ä¾é™„åŸ‹ç‚¹å‚æ•°åˆ°è§†å›¾æ ‘

`ITrackModel`æ¥å£å®šä¹‰äº†ä¸€ä¸ªæ•°æ®å¡«å……èƒ½åŠ›ï¼Œä½ å¯ä»¥åˆ›å»ºå®ƒçš„å®ç°ç±»æ¥å®šä¹‰ä¸€ä¸ªæ•°æ®èŠ‚ç‚¹ï¼Œå¹¶åœ¨ fillTrackParams() æ–¹æ³•ä¸­å£°æ˜å‚æ•°ã€‚ä¾‹å¦‚ï¼šMyGoodsViewHolder å®ç°äº† ITrackMode æ¥å£ï¼Œåœ¨ fillTrackParams() æ–¹æ³•ä¸­å£°æ˜å‚æ•°ï¼ˆgoods_id / goods_nameï¼‰ã€‚

éšåï¼Œé€šè¿‡ View çš„æ‰©å±•å‡½æ•°`View.trackModel()`å°†å…¶ä¾é™„åˆ°è§†å›¾èŠ‚ç‚¹ä¸Šã€‚æ‰©å±•å‡½æ•° View.trackModel() å†…éƒ¨åŸºäº View#setTag() å®ç°ã€‚

`MyGoodsViewHolder.kt`
```
class MyGoodsViewHolder(itemView: View) : RecyclerView.ViewHolder(itemView), ITrackModel {

    private var mItem: GoodsItem? = null

    init {
        // Javaï¼šEasyTrackUtilsKt.setTrackModel(itemView, this);
        itemView.trackModel = this
    }

     override fun fillTrackParams(params: TrackParams) {
        mItem?.let {
            params.setIfNull("goods_id", it.id)
            params.setIfNull("goods_name", it.goods_name)
        }
    }
}
```

`EasyTrackUtils.kt`
```
/**
 * Attach track model on the view.
 */
var View.trackModel: ITrackModel?
    get() = this.getTag(R.id.tag_id_track_model) as? ITrackModel
    set(value) {
        this.setTag(R.id.tag_id_track_model, value)
    }
```

`ITrackModel.kt`
```
/**
 * å®šä¹‰æ•°æ®å¡«å……èƒ½åŠ›
 */
interface ITrackModel : Serializable {
    /**
     * æ•°æ®å¡«å……
     */
    fun fillTrackParams(params: TrackParams)
}
```

#### 5.3 è§¦å‘äº‹ä»¶åŸ‹ç‚¹

åœ¨éœ€è¦åŸ‹ç‚¹çš„åœ°æ–¹ï¼Œç›´æ¥é€šè¿‡å®šä¹‰åœ¨ View ä¸Šçš„æ‰©å±•å‡½æ•° `trackEvent(äº‹ä»¶å)`è§¦å‘åŸ‹ç‚¹äº‹ä»¶ï¼Œå®ƒä¼šä»¥è¯¥æ‰©å±•å‡½æ•°çš„æ¥æ”¶è€…å¯¹è±¡ä¸ºèµ·ç‚¹ï¼Œé€çº§å‘ä¸Šå±‚è§†å›¾èŠ‚ç‚¹æ”¶é›†å‚æ•°ã€‚å¦å¤–ï¼Œå®ƒè¿˜æœ‰å¤šä¸ªå®šä¹‰åœ¨ Activityã€Fragmentã€ViewHolder ä¸Šçš„æ‰©å±•å‡½æ•°ï¼Œä½†æœ€ç»ˆéƒ½ä¼šè°ƒç”¨åˆ° View.trackEventã€‚

```
class MyGoodsViewHolder(itemView: View) : RecyclerView.ViewHolder(itemView) {
     fun bind(item: GoodsItem) {
        ...
        trackEvent(GOODS_EXPOSE)
    }
}
```

`EasyTrackUtils.kt`
```
@JvmOverloads
fun Activity?.trackEvent(eventName: String, params: TrackParams? = null) =
    findRootView(this)?.doTrackEvent(eventName, params)

@JvmOverloads
fun Fragment?.trackEvent(eventName: String, params: TrackParams? = null) =
    this?.requireView()?.doTrackEvent(eventName, params)

@JvmOverloads
fun RecyclerView.ViewHolder?.trackEvent(eventName: String, params: TrackParams? = null) {
    this?.itemView?.let {
        if (null == it.parent) {
            it.post { it.doTrackEvent(eventName, params) }
        } else {
            it.doTrackEvent(eventName, params)
        }
    }
}

@JvmOverloads
fun View?.trackEvent(eventName: String, params: TrackParams? = null): TrackParams? =
    this?.doTrackEvent(eventName, params)
```

æŸ¥çœ‹ logcat æ—¥å¿—ï¼Œå¯ä»¥çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—ï¼Œæ˜¾ç¤ºåŸ‹ç‚¹å¹¶æ²¡æœ‰ç”Ÿæ•ˆã€‚è¿™æ˜¯å› ä¸ºæ²¡æœ‰ä¸º EasyTrack é…ç½®åŸ‹ç‚¹æ•°æ®ä¸ŠæŠ¥å’Œç»Ÿè®¡åˆ†æçš„èƒ½åŠ›ã€‚

`logcat æ—¥å¿—`
```
EasyTrackLib: Try track event goods_expose, but the providers is Empty.
```

#### 5.4 å®ç° ITrackProvider æ¥å£

EasyTrack çš„èŒè´£åœ¨äºæ”¶é›†åˆ†æ•£çš„åŸ‹ç‚¹æ•°æ®ï¼Œæœ¬èº«æ²¡æœ‰æä¾›åŸ‹ç‚¹æ•°æ®ä¸ŠæŠ¥å’Œç»Ÿè®¡åˆ†æçš„èƒ½åŠ›ã€‚å› æ­¤ï¼Œä½ éœ€è¦å®ç° ITrackProvider æ¥å£è¿›è¡Œä¾èµ–æ³¨å…¥ã€‚ä¾‹å¦‚ï¼Œè¿™é‡Œæ¨¡æ‹Ÿå®ç°å‹ç›Ÿæ•°æ®åŸ‹ç‚¹æä¾›å™¨ï¼Œåœ¨ onInit() æ–¹æ³•ä¸­è¿›è¡Œåˆå§‹åŒ–ï¼Œåœ¨ onEvent() æ–¹æ³•ä¸­è°ƒç”¨å‹ç›Ÿ SDK äº‹ä»¶ä¸ŠæŠ¥æ–¹æ³•ã€‚

`MockUmengProvider.kt`
```
/**
 * æ¨¡æ‹Ÿå‹ç›Ÿæ•°æ®ä¸ŠæŠ¥
 */
class MockUmengProvider : ITrackProvider() {

    companion object {
        const val TAG = "Umeng"
    }

    /**
     * æ˜¯å¦å¯ç”¨
     */
    override var enabled = true

    /**
     * åç§°
     */
    override var name = TAG

    /**
     * åˆå§‹åŒ–
     */
    override fun onInit() {
        Log.d(TAG, "Init Umeng provider.")
    }

    /**
     * æ‰§è¡Œäº‹ä»¶ä¸ŠæŠ¥
     */
    override fun onEvent(eventName: String, params: TrackParams) {
        Log.d(TAG, params.toString())
    }
}
```

#### 5.5 é…ç½® EasyTrack

åœ¨åº”ç”¨åˆå§‹åŒ–æ—¶ï¼Œè¿›è¡Œ EasyTrack çš„åˆå§‹åŒ–é…ç½®ã€‚æˆ‘ä»¬å¯ä»¥å°†ç›¸å…³çš„åˆå§‹åŒ–ä»£ç å•ç‹¬å°è£…èµ·æ¥ï¼Œä¾‹å¦‚ï¼š

`StatisticsUtils.kt`
```
// æ¨¡æ‹Ÿå‹ç›Ÿæ•°æ®ç»Ÿè®¡æä¾›å™¨
val umengProvider by lazy {
    MockUmengProvider()
}

// æ¨¡æ‹Ÿç¥ç­–æ•°æ®ç»Ÿè®¡æä¾›å™¨
val sensorProvider by lazy {
    MockSensorProvider()
}

/**
 * åˆå§‹åŒ– EasyTrackï¼Œåœ¨ Application åˆå§‹åŒ–æ—¶è°ƒç”¨
 */
fun init(context: Context) {
    configStatistics(context)
    registerProviders(context)
}

/**
 * é…ç½®
 */
private fun configStatistics(context: Context) {
    // è°ƒè¯•å¼€å…³
    EasyTrack.debug = BuildConfig.DEBUG
    // é¡µé¢é—´å‚æ•°æ˜ å°„
    EasyTrack.referrerKeyMap = mapOf(
        CUR_PAGE to FROM_PAGE,
        CUR_TAB to FROM_TAB
    )
}

/**
 * æ³¨å†Œæä¾›å™¨
 */
private fun registerProviders(context: Context) {
    EasyTrack.registerProvider(umengProvider)
    EasyTrack.registerProvider(sensorProvider)
}
```
`EventConstants.java`
```
public static final String FROM_PAGE = "from_page";
public static final String CUR_PAGE = "cur_page";
public static final String FROM_TAB = "from_tab";
public static final String CUR_TAB = "cur_tab";
```

|é…ç½®|ç±»å‹|æè¿°|
|:---|:---|:---|
|debug|Boolean|è°ƒè¯•å¼€å…³|
|referrerKeyMap|Map<String,String>|å…¨å±€é¡µé¢é—´å‚æ•°æ˜ å°„|
|registerProvider()|ITrackProvider|åº•å±‚æ•°æ®åŸ‹ç‚¹èƒ½åŠ›|

ä»¥ä¸Šæ­¥éª¤æ˜¯ EasyTrack çš„å¿…é€‰æ­¥éª¤ï¼Œå®Œæˆåé‡æ–°æ‰§è¡Œ trackEvent() åå¯ä»¥çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—ï¼š

`logcat æ—¥å¿—`
```
/EasyTrackLib:  
onEventï¼šgoods_expose
goods_id= 10000
goods_name = å•†å“å
Try track event goods_expose with provider Umeng.
Try track event goods_expose with provider Sensor.
------------------------------------------------------
```

#### 5.6 é¡µé¢é—´å‚æ•°æ˜ å°„

ä¸Šä¸€èŠ‚ä¸­æœ‰ä¸€ä¸ª`referrerKeyMap`é…ç½®é¡¹ï¼Œ**å®šä¹‰äº†å…¨å±€çš„é¡µé¢é—´å‚æ•°æ˜ å°„ã€‚** ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨åˆ†æä¸åŒå…¥å£çš„è½¬åŒ–ç‡æ—¶ï¼Œä¸ä»…ä»…éœ€è¦ä¸ŠæŠ¥å½“å‰é¡µé¢çš„æ•°æ®ï¼Œè¿˜éœ€è¦ä¸ŠæŠ¥æ¥æºé¡µé¢çš„ä¿¡æ¯ã€‚è¿™æ ·æˆ‘ä»¬æ‰èƒ½åˆ†æç”¨æˆ·ç»è¿‡æ€æ ·çš„è·¯å¾„æ¥åˆ°å½“å‰é¡µé¢ï¼Œå¹¶æœ€ç»ˆè§¦å‘äº†æŸä¸ªè¡Œä¸ºã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¥æºé¡µé¢çš„å‚æ•°å¾€å¾€ä¸èƒ½ç›´æ¥æ·»åŠ åˆ°å½“å‰é¡µé¢çš„åŸ‹ç‚¹å‚æ•°ä¸­ï¼Œè¿™é‡Œä¸€èˆ¬ä¼šæœ‰ä¸€å®šçš„è½¬æ¢è§„åˆ™ / æ˜ å°„å…³ç³»ã€‚ä¾‹å¦‚ï¼š**æ¥æºé¡µé¢çš„ cur_page å‚æ•°ï¼Œåœ¨å½“å‰é¡µé¢åº”è¯¥æ˜ å°„ä¸º from_page å‚æ•°ã€‚** åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬é…ç½®çš„æ˜ å°„å…³ç³»æ˜¯ï¼š

- æ¥æºé¡µé¢çš„ cur_page æ˜ å°„ä¸ºå½“å‰é¡µé¢çš„ from_pageï¼›
- æ¥æºé¡µé¢çš„ cur_tab æ˜ å°„ä¸ºå½“å‰é¡µé¢çš„ from_tabã€‚

å› æ­¤ï¼Œå‡è®¾æ¥æºé¡µé¢ä¼ é€’ç»™å½“å‰é¡µé¢çš„å‚æ•°æ˜¯ Aï¼Œåˆ™å½“å‰é¡µé¢åœ¨è§¦å‘äº‹ä»¶æ—¶çš„æ”¶é›†å‚æ•°æ˜¯ Bï¼š

```
A (æ¥æºé¡µé¢)ï¼š
{
    "cur_page" : "list"
    ...
}

B (å½“å‰é¡µé¢)ï¼š
{
    "cur_page" : "detail",
    "from_page" : "list",
    ...
}
```

`BaseTrackActivity` å®ç°äº†é¡µé¢é—´å‚æ•°æ˜ å°„ï¼Œä½ å¯ä»¥åˆ›å»º BaseActivity ç±»å¹¶ç»§æ‰¿äº BaseTrackActivityï¼Œæˆ–è€…å°†å…¶å†…éƒ¨çš„é€»è¾‘è¿ç§»åˆ°ä½ çš„ BaseActivity ä¸­ã€‚è¿™ä¸€æ­¥æ˜¯å¯é€‰çš„ï¼Œå¦‚æœä½ ä¸ä½¿ç”¨é¡µé¢é—´å‚æ•°æ˜ å°„çš„ç‰¹æ€§ï¼Œä½ é‚£å¤§å¯ä¸å¿…ä½¿ç”¨ BaseTrackActivityã€‚

|æ“ä½œ|æè¿°|
|:---|:---|
|å®šä¹‰æ˜ å°„å…³ç³»|1ã€EasyTrack.referrerKeyMap é…ç½®é¡¹<br>2ã€é‡å†™ BaseTrackActivity #referrerKeyMap() æ–¹æ³•|
|ä¼ é€’é¡µé¢é—´å‚æ•°|Intent.referrerSnapshot(TrackParams) æ‰©å±•å‡½æ•°|

`MyGoodsDetailActivity.java`
```
public class MyGoodsDetailActivity extends MyBaseActivity {

    private static final String EXTRA_GOODS = "extra_goods";

    public static void start(Context context, GoodsItem item, TrackParams params) {
        Intent intent = new Intent(context, GoodsDetailActivity.class);
        intent.putExtra(EXTRA_GOODS, item);
        EasyTrackUtilsKt.setReferrerSnapshot(intent, params);
        context.startActivity(intent);
    }

    @Nullable
    @Override
    protected String getCurPage() {
        return GOODS_DETAIL_NAME;
    }

    @Nullable
    @Override
    public Map<String, String> referrerKeyMap() {
        Map<String, String> map = new HashMap<>();
        map.put(STORE_ID, STORE_ID);
        map.put(STORE_NAME, STORE_NAME);
        return map;
    }
}
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒBaseTrackActivity ä¸ä¼šå°†æ¥æºé¡µé¢çš„å…¨éƒ¨å‚æ•°éƒ½æ·»åŠ åˆ°å½“å‰é¡µé¢çš„å‚æ•°ä¸­ï¼Œ**åªæœ‰åœ¨å…¨å±€ referrerKeyMap é…ç½®é¡¹æˆ– referrerKeyMap() æ–¹æ³•ä¸­å®šä¹‰äº†æ˜ å°„å…³ç³»çš„å‚æ•°ï¼Œæ‰ä¼šæ·»åŠ åˆ°å½“å‰é¡µé¢ã€‚** ä¾‹å¦‚ï¼šMyGoodsDetailActivity ç»§æ‰¿äº BaseActivityï¼Œå¹¶é‡å†™ referrerKeyMap() å®šä¹‰äº†æ„Ÿå…´è¶£çš„å‚æ•°ï¼ˆSTORE_IDã€STORE_NAMEï¼‰ã€‚æœ€ç»ˆè§¦å‘åŸ‹ç‚¹æ—¶çš„æ—¥å¿—å¦‚ä¸‹ï¼š

`logcat æ—¥å¿—`
```
/EasyTrackLib:  
onEventï¼šgoods_detail_expose
goods_id= 10000
goods_name = å•†å“å
store_id = 10000
store_name = å•†åº—å
from_page = Recommend
cur_page = goods_detail
Try track event goods_expose with provider Umeng.
Try track event goods_expose with provider Sensor.
------------------------------------------------------
```

åœ¨ä¸€èˆ¬çš„åŸ‹ç‚¹æ¨¡å‹ä¸­ï¼Œæ¯ä¸ª Activity (é¡µé¢) éƒ½æœ‰å¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„ page_idï¼Œå› æ­¤ä½ å¯ä»¥é‡å†™ fillTrackParams()  æ–¹æ³•è¿½åŠ è¿™äº›å›ºå®šçš„å‚æ•°ã€‚ä¾‹å¦‚ï¼šMyBaseActivity å®šä¹‰äº†  getCurPage() æ–¹æ³•ï¼Œå­ç±»å¯ä»¥é€šè¿‡é‡å†™  getCurPage() æ¥è®¾ç½® page_idã€‚

`MyBaseActivity.java`
```
abstract class MyBaseActivity : BaseTrackActivity() {

    @CallSuper
    override fun fillTrackParams(params: TrackParams) {
        super.fillTrackParams(params)
        // å¡«å……é¡µé¢ç»Ÿä¸€å‚æ•°
        getCurPage()?.also {
            params.setIfNull(CUR_PAGE, it)
        }
    }

    protected open fun getCurPage(): String? = null
}
```

#### 5.7 TrackParams å‚æ•°å®¹å™¨

TrackParams æ˜¯ EasyTrack æ”¶é›†å‚æ•°çš„ä¸­é—´å®¹å™¨ï¼Œæœ€ç»ˆä¼šåˆ†å‘ç»™ ITrackProvider ä½¿ç”¨ã€‚

|æ–¹æ³•|æè¿°|
|:---|:---|
|set(key: String, value: Any?)|è®¾ç½®å‚æ•°ï¼Œæ— è®ºæ— ä½•éƒ½è¦†ç›–|
|setIfNull(key: String, value: Any?)|è®¾ç½®å‚æ•°ï¼Œå¦‚æœå·²ç»å­˜åœ¨è¯¥å‚æ•°åˆ™ä¸¢å¼ƒ|
|get(key: String): String?|è·å–å‚æ•°å€¼ï¼Œå‚æ•°ä¸å­˜åœ¨åˆ™è¿”å› null|
|get(key: String, default: String?)|è·å–å‚æ•°å€¼ï¼Œå‚æ•°ä¸å­˜åœ¨åˆ™è¿”å›é»˜è®¤å€¼ default|

#### 5.8 ä½¿ç”¨ Kotlin å§”æ‰˜ä¾é™„å‚æ•°

å¦‚æœä½ è§‰å¾—æ¯æ¬¡å®šä¹‰ ITrackModel æ•°æ®èŠ‚ç‚¹åéƒ½éœ€è¦è°ƒç”¨ View.trackModelï¼Œä½ å¯ä»¥ä½¿ç”¨æˆ‘å®šä¹‰çš„ Kotlin å§”æ‰˜ â€œè·³è¿‡â€ è¿™ä¸ªæ­¥éª¤ï¼Œä¾‹å¦‚ï¼š

`MyFragment.kt`
```
private val trackNode by track()
```

`EasyTrackUtils.kt`
```
fun <F : Fragment> F.track(): TrackNodeProperty<F> = FragmentTrackNodeProperty()

fun RecyclerView.ViewHolder.track(): TrackNodeProperty<RecyclerView.ViewHolder> =
    LazyTrackNodeProperty() viewFactory@{
        return@viewFactory itemView
    }

fun View.track(): TrackNodeProperty<View> = LazyTrackNodeProperty() viewFactory@{
    return@viewFactory it
}
```

å¦‚æœä½ è¿˜ä¸äº†è§£å§”æ‰˜å±æ€§ï¼Œå¯ä»¥çœ‹ä¸‹æˆ‘ä¹‹å‰å†™è¿‡çš„ä¸€ç¯‡æ–‡ç« ï¼Œè¿™é‡Œä¸è§£é‡Šå…¶åŸç†äº†ï¼š[Android | ViewBinding ä¸ Kotlin å§”æ‰˜åŒå‰‘åˆç’§](https://juejin.cn/post/6958346113552220173)

---
# 6. EasyTrack æ ¸å¿ƒæºç 

è¿™ä¸€èŠ‚ï¼Œæˆ‘ç®€å•ä»‹ç»ä¸‹ EasyTrack çš„æ ¸å¿ƒæºç ï¼Œæœ€æ ¸å¿ƒçš„éƒ¨åˆ†åœ¨å…¥å£ç±» EasyTrack ä¸­ï¼š

#### 6.1 doTrackEvent()

doTrackEvent() æ˜¯è§¦å‘åŸ‹ç‚¹çš„ä¸»æ–¹æ³•ï¼Œä¸»è¦æµç¨‹æ˜¯è°ƒç”¨ fillTrackParams() æ”¶é›†åŸ‹ç‚¹å‚æ•°ï¼Œå†å°†å‚æ•°åˆ†å‘ç»™æœ‰æ•ˆçš„ ITrackProviderã€‚

```
internal fun Any.doTrackEvent(eventName: String, otherParams: TrackParams? = null): TrackParams? {
    1. æ£€æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆçš„ ITrackProvider
    2. åŸºäºè§†å›¾æ ‘é€’å½’æ”¶é›†åŸ‹ç‚¹å‚æ•°ï¼ˆfillTrackParamsï¼‰
    3. æ—¥å¿—
    4. å°†æ”¶é›†åˆ°çš„åŸ‹ç‚¹å‚æ•°åˆ†å‘ç»™æœ‰æ•ˆçš„ ITrackProvider
}
```

#### 6.2 fillTrackParams()

```
-> åŸºäºè§†å›¾æ ‘é€’å½’æ”¶é›†åŸ‹ç‚¹å‚æ•°
internal fun fillTrackParams(node: Any?, params: TrackParams? = null): TrackParams {
    val result = params ?: TrackParams()
    var curNode = node
    while (null != curNode) {
        when (curNode) {
            is View -> {
                // 1. è§†å›¾èŠ‚ç‚¹
                if (android.R.id.content == curNode.id) {
                    // 1.1 Activity èŠ‚ç‚¹
                    val activity = getActivityFromView(curNode)
                    if (activity is IPageTrackNode) {
                        // 1.1.1 IPageTrackNodeèŠ‚ç‚¹ï¼ˆå¤„ç†é¡µé¢é—´å‚æ•°æ˜ å°„ï¼‰
                        activity.fillTrackParams(result)
                        curNode = activity.referrerSnapshot()
                    } else {
                        // 1.1.2 ç»ˆæ­¢
                        curNode = null
                    }
                } else {
                    // 1.2 Activity è§†å›¾å­èŠ‚ç‚¹
                    curNode.trackModel?.fillTrackParams(result)
                    curNode = curNode.parent
                }
            }
            is ITrackNode -> {
                // 2. éè§†å›¾èŠ‚ç‚¹
                curNode.fillTrackParams(result)
                curNode = curNode.parent
            }
            else -> {
                // 3. ç»ˆæ­¢
                curNode = null
            }
        }
    }
    return result
}
```

ä¸»è¦é€»è¾‘ï¼šä»å…¥å‚ node ä¸ºèµ·ç‚¹ï¼Œå¾ªç¯è·å–ä¾é™„åœ¨è§†å›¾èŠ‚ç‚¹ä¸Šçš„ ITrackModel æ•°æ®èŠ‚ç‚¹å¹¶è°ƒç”¨ fillTrackParams() æ–¹æ³•æ”¶é›†å‚æ•°ï¼Œå¹¶å°†å¾ªç¯æŒ‡é’ˆæŒ‡å‘ parentã€‚

---
# 7. æ€»ç»“

EasyTrack æ¡†æ¶çš„æºç æˆ‘å·²ç»æ”¾åœ¨ Github ä¸Šäº†ï¼Œæºç åœ°å€ï¼šhttps://github.com/pengxurui/EasyTrack æˆ‘ä¹Ÿå†™äº†ä¸€ä¸ªç®€å•çš„ Sample Demoï¼Œä½ å¯ä»¥ç›´æ¥è¿è¡Œä½“éªŒä¸‹ã€‚æ¬¢è¿æ‰¹è¯„ï¼Œæ¬¢è¿ Issue~

è¯´è¯´ç›®å‰é‡åˆ°çš„é—®é¢˜ï¼Œåœ¨å¤„ç†é¡µé¢é—´å‚æ•°ä¼ é€’æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¾èµ– Intent extras å‚æ•°ã€‚è¿™å°±å¯¼è‡´æˆ‘ä»¬éœ€è¦åœ¨å¤§é‡åˆ›å»º Intent çš„åœ°æ–¹éƒ½åŠ å…¥æ¥æºé¡µé¢çš„åŸ‹ç‚¹å‚æ•°ï¼ˆæ³¨æ„ï¼šå³ä½¿ä½ ä¸ä½¿ç”¨ EasyTrackï¼Œä½ ä¹Ÿè¦è¿™ä¹ˆåšï¼‰ã€‚ç›®å‰æˆ‘è¿˜æ²¡æœ‰æƒ³åˆ°æ¯”è¾ƒå¥½çš„æ–¹æ³•ï¼Œä½ è§‰å¾—å‘¢ï¼Ÿè¯´è¯´ä½ çš„çœ‹æ³•å§ã€‚

---
#### å‚è€ƒèµ„æ–™
- [è¥¿ç“œå®¢æˆ·ç«¯åŸ‹ç‚¹å®è·µï¼šåŸºäºè´£ä»»é“¾çš„åŸ‹ç‚¹æ¡†æ¶](https://mp.weixin.qq.com/s/iMn--4FNugtH26G90N1MaQ) â€”â€” ä½•é‡‘æµ·ï¼ˆå­—èŠ‚ï¼‰è‘—
- [åŸ‹ç‚¹æ²»ç†ï¼šå¦‚ä½•æŠŠ App åŸ‹ç‚¹åšåˆ°æè‡´ï¼Ÿ](https://mp.weixin.qq.com/s/O_02RsP9U2N4cXQH5rc0zQ) â€”â€” æ—ä¹æ´‹ï¼ˆ58ï¼‰è‘—
- [51 ä¿¡ç”¨å¡ Android è‡ªåŠ¨åŸ‹ç‚¹å®è·µ](https://mp.weixin.qq.com/s/P95ATtgT2pgx4bSLCAzi3Q) â€”â€” æä¼ å¿—ï¼ˆ51 ä¿¡ç”¨å¡ï¼‰è‘—
- [åˆ©ç”¨ Live Templates æ‰“é€ åŸ‹ç‚¹è‡ªåŠ¨åŒ–åˆ©å™¨](https://juejin.cn/post/6966758717773578270) â€”â€” å­—èŠ‚å¤§åŠ›æ™ºèƒ½æŠ€æœ¯å›¢é˜Ÿ è‘—
- [æ•°æ®åˆ†æä»ç†å¿µåˆ°å®æ“](https://sensorsdata.cn/uploads/773b55bdee9e1884963493cda4e73aa1/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%BB%8E%E7%90%86%E5%BF%B5%E5%88%B0%E5%AE%9E%E6%93%8D%E7%99%BD%E7%9A%AE%E4%B9%A6.pdf) â€”â€” ç¥ç­–æ•°æ® è‘—

> **åˆ›ä½œä¸æ˜“ï¼Œä½ çš„ã€Œä¸‰è¿ã€æ˜¯ä¸‘ä¸‘æœ€å¤§çš„åŠ¨åŠ›ï¼Œæˆ‘ä»¬ä¸‹æ¬¡è§ï¼**

## Donate

å¦‚æœæœ¬ä»“åº“å¯¹ä½ æœ‰å¸®åŠ©ï¼Œå¯ä»¥è¯·å°å½­å–æ¯é€Ÿæº¶å’–å•¡ã€‚

![](https://github.com/pengxurui/AndroidFamily/blob/master/images/%E8%AF%B7%E5%B0%8F%E5%BD%AD%E5%96%9D%E6%9D%AF%E9%80%9F%E6%BA%B6%E5%92%96%E5%95%A1.png)

## License

Copyright [2022] [Peng Xurui]

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

[http://www.apache.org/licenses/LICENSE-2.0](http://www.apache.org/licenses/LICENSE-2.0)

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
